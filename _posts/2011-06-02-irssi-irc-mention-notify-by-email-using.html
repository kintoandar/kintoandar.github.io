---
layout: post
title: IRSSI IRC mention notify by email using ssmtp
date: '2011-06-02T15:48:00.001+01:00'
author: Joel Bastos
tags: 
modified_time: '2011-11-15T11:52:32.728Z'
thumbnail: http://2.bp.blogspot.com/-Xa8BEDNaovg/TeeFK4xJ7TI/AAAAAAAAAVs/XUqHt4TCCbM/s72-c/irssitop.png
blogger_id: tag:blogger.com,1999:blog-1780138848439428569.post-1300278578663307227
blogger_orig_url: http://blog.kintoandar.com/2011/06/irssi-irc-mention-notify-by-email-using.html
comments: true
---

<div class="separator" style="clear: both; font-family: Arial,Helvetica,sans-serif; text-align: center;"><a href="http://www.irssi.org/" imageanchor="1" style="margin-left: 1em; margin-right: 1em;" target="blank"><img border="0" height="146" src="http://2.bp.blogspot.com/-Xa8BEDNaovg/TeeFK4xJ7TI/AAAAAAAAAVs/XUqHt4TCCbM/s320/irssitop.png" width="320" /></a></div><div style="font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="font-family: Arial,Helvetica,sans-serif;">I've always been a huge fan of <a href="http://www.irssi.org/" target="blank">IRSSI</a> client, the provided simplicity and customisation are a major benefit for all IRC users out there.</div><div style="font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="font-family: Arial,Helvetica,sans-serif;"></div><div style="font-family: Arial,Helvetica,sans-serif;"></div><div style="font-family: Arial,Helvetica,sans-serif;">As it runs inside screen and is designed for permanent availability without downtimes, it's easy to forget to check it for new messages on the connected channels. After looking for something to keep track of my nickname mentions I've found <a href="http://www.leemhuis.info/files/fnotify/fnotify" target="blank">fnotify</a> to be a good candidate to remember me to check for new messages. But fnotify only logs nick mentions to a text file, so I've "improved" it to send a email so that I could always be warned when someone tries to talk to me.</div><div style="font-family: Arial,Helvetica,sans-serif;"><br />Here is a small modification I've made to the fnotify plugin so it may notify me by email every time my nickname is mentioned on a channel. It uses <a href="http://www.linux.com/archive/feature/132006" target="blank">ssmtp</a> to send email through gmail.</div><div style="font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="font-family: Arial,Helvetica,sans-serif;">You only have to set 2 variables on the script:</div><ul style="font-family: Arial,Helvetica,sans-serif;"><li><span style="color: red;">$EMAIL</span> - Your notify email address</li><li><span style="color: red;">$SSMTP</span> - The path to the ssmtp client</li></ul><div style="font-family: Arial,Helvetica,sans-serif;"><i><br /></i></div><div style="font-family: Arial,Helvetica,sans-serif;"><i><span style="color: #38761d;">[user@gambit ~]$</span><span style="color: black;"> </span>cat .irssi/scripts/autorun/fnotify.pl</i></div><blockquote><div style="font-family: Arial,Helvetica,sans-serif;">&nbsp;# todo: grap topic changes<br /><br />use strict;<br />use vars qw($VERSION %IRSSI);<br /><br />use Irssi;<br />$VERSION = '0.0.3';<br />%IRSSI = (<br />&nbsp;&nbsp; &nbsp;authors&nbsp;&nbsp;&nbsp;&nbsp; =&gt; 'Thorsten Leemhuis',<br />&nbsp;&nbsp; &nbsp;contact&nbsp;&nbsp;&nbsp;&nbsp; =&gt; 'fedora@leemhuis.info',<br />&nbsp;&nbsp; &nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&gt; 'fnotify',<br />&nbsp;&nbsp; &nbsp;description =&gt; 'Write a notification to a file that shows who is talking to you in which channel.',<br />&nbsp;&nbsp; &nbsp;url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&gt; 'http://www.leemhuis.info/files/fnotify/',<br />&nbsp;&nbsp; &nbsp;license&nbsp;&nbsp;&nbsp;&nbsp; =&gt; 'GNU General Public License',<br />&nbsp;&nbsp; &nbsp;changed&nbsp;&nbsp;&nbsp;&nbsp; =&gt; '$Date: 2007-01-13 12:00:00 +0100 (Sat, 13 Jan 2007) $'<br />);<br /><br />#--------------------------------------------------------------------<br /># In parts based on knotify.pl 0.1.1 by Hugo Haas<br /># http://larve.net/people/hugo/2005/01/knotify.pl<br /># which is based on osd.pl 0.3.3 by Jeroen Coekaerts, Koenraad Heijlen<br /># http://www.irssi.org/scripts/scripts/osd.pl<br />#<br /># Other parts based on notify.pl from Luke Macken<br /># http://fedora.feedjack.org/user/918/<br />#<br /># ssmtp email notification support added by Joel Bastos<br /># http://kintoandar.blogspot.com<br />#<br />#--------------------------------------------------------------------<br /><br /># Please set the variables (don't forget to escape "\" the "@" symbol like the example) <br />my <span style="color: red;">$EMAIL</span> = "myemail\@gmail.com";<br />my <span style="color: red;">$SSMTP</span> = "/usr/sbin/ssmtp";<br /><br />#--------------------------------------------------------------------<br /># Private message parsing<br />#--------------------------------------------------------------------<br /><br />sub priv_msg {<br />&nbsp;&nbsp; &nbsp;my ($server,$msg,$nick,$address,$target) = @_;<br />&nbsp;&nbsp; &nbsp;filewrite($nick." " .$msg );<br />}<br /><br />#--------------------------------------------------------------------<br /># Printing hilight's<br />#--------------------------------------------------------------------<br /><br />sub hilight {<br />&nbsp;&nbsp;&nbsp; my ($dest, $text, $stripped) = @_;<br />&nbsp;&nbsp;&nbsp; if ($dest-&gt;{level} &amp; MSGLEVEL_HILIGHT) {<br />&nbsp;&nbsp; &nbsp;filewrite($dest-&gt;{target}. " " .$stripped );<br />&nbsp;&nbsp;&nbsp; }<br />}<br /><br />#--------------------------------------------------------------------<br /># The actual printing<br />#--------------------------------------------------------------------<br /><br />sub filewrite {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my ($text) = @_;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # FIXME: there is probably a better way to get the irssi-dir...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my $date = `date` ;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; open(FILE,"&gt;&gt;$ENV{HOME}/.irssi/fnotify");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print FILE $date . $text . "\n\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; close (FILE);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my $mail=`echo "Subject: IRSSI"|cat - $ENV{HOME}/.irssi/fnotify|$SSMTP $EMAIL`;<br />}<br /><br />#--------------------------------------------------------------------<br /># Irssi::signal_add_last / Irssi::command_bind<br />#--------------------------------------------------------------------<br /><br />Irssi::signal_add_last("message private", "priv_msg");<br />Irssi::signal_add_last("print text", "hilight");<span class="Apple-style-span" style="font-family: 'Times New Roman';">&nbsp;</span></div></blockquote><br /><br /><span class="Apple-style-span" style="font-family: Arial, Helvetica, sans-serif;"><span class="Apple-style-span" style="color: red;">Link to github:</span>&nbsp;<a href="http://git.io/DY4iaA" target="_blank">http://git.io/DY4iaA</a></span>
