---
layout: post
title: Server side SVN + SSH logging
date: '2013-03-24T19:08:00.002Z'
author: Joel Bastos
tags: 
modified_time: '2013-03-24T19:30:56.509Z'
thumbnail: https://2.bp.blogspot.com/-BJfYYHYXzTI/UU9ONBB0aPI/AAAAAAAAArU/W0JxGIYtdHE/s72-c/logs.jpg
blogger_id: tag:blogger.com,1999:blog-1780138848439428569.post-6890636412820451336
blogger_orig_url: http://blog.kintoandar.com/2013/03/server-side-svn-ssh-logging.html
comments: true
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://subversion.apache.org/" imageanchor="1" style="margin-left: 1em; margin-right: 1em;" target="_blank"><img border="0" height="153" src="https://2.bp.blogspot.com/-BJfYYHYXzTI/UU9ONBB0aPI/AAAAAAAAArU/W0JxGIYtdHE/s320/logs.jpg" width="320" /></a></div><span style="font-family: Arial,Helvetica,sans-serif;"></span><br /><span style="font-family: Arial,Helvetica,sans-serif;">After searching the interwebs for a method on obtaining server side logging capability on SVN over SSH with no success, I decided to do some reverse engineering on how SVN works hopping to get it logging every user action on each repository.&nbsp;</span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">What I've found is that every client SVN call to the server via SSH launches svnserve, and indeed there is a <i>svnserve.conf</i> config file on every repository, unfortunately with no log flag available. Nontheless the svnserve binary accepts the desired log flag, so let's get creative...</span><span style="font-family: Arial,Helvetica,sans-serif;"><span style="color: #38761d;">&nbsp;</span></span><br /><blockquote class="tr_bq"><span style="font-family: Arial,Helvetica,sans-serif;"><span style="color: #38761d;">[root@svn-server ~]#</span> mkdir /var/log/svn/</span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;"><span style="color: #38761d;">[root@svn-server ~]#</span> whereis svnserve<br />svnserve: /usr/bin/svnserve<span style="color: #6aa84f;">&nbsp;</span></span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;"><span style="color: #6aa84f;">[<span style="color: #38761d;">root@svn-server ~]#</span></span> mv </span><span style="font-family: Arial,Helvetica,sans-serif;">/usr/bin/svnserve </span><span style="font-family: Arial,Helvetica,sans-serif;">/usr/bin/svnserve.bin<span style="color: #38761d;"><span style="font-family: Arial,Helvetica,sans-serif;">&nbsp;</span></span></span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;"><span style="color: #38761d;"><span style="font-family: Arial,Helvetica,sans-serif;">[root@svn-server ~]</span>#</span> vi /usr/bin/svnserve</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><span style="font-family: Arial,Helvetica,sans-serif;">/usr/bin/svnserve.bin</span> --log-file /var/log/svn/svnserve_`id -u`.log $1<span style="color: #38761d;"><span style="font-family: Arial,Helvetica,sans-serif;">&nbsp;</span></span></span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;"><span style="color: #38761d;"><span style="font-family: Arial,Helvetica,sans-serif;">[root@svn-server ~]</span>#</span> chmod +x&nbsp; </span><span style="font-family: Arial,Helvetica,sans-serif;">/usr/bin/svnserve</span></blockquote><b><span style="font-family: Arial,Helvetica,sans-serif;">There, you got logging!</span></b><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">What some log rotating? Sure, here you go:</span><br /><blockquote class="tr_bq"><span style="font-family: Arial,Helvetica,sans-serif;"><span style="color: #38761d;"><span style="font-family: Arial,Helvetica,sans-serif;">[root@svn-server ~]</span>#</span> cat /etc/logrotate.d/svn</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"></span></blockquote><blockquote><span style="font-family: Arial,Helvetica,sans-serif;">/var/log/svn/svnserve*.log {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; daily<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rotate 365<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; missingok<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; notifempty<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lastaction<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /bin/chown root.root /var/log/svn/svnserve*.log.* &gt; /dev/null &amp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /bin/chmod 600 /var/log/svn/svnserve*.log.* &gt; /dev/null &amp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endscript<br />}</span></blockquote><span style="font-family: Arial,Helvetica,sans-serif;"></span><br /><span style="font-family: Arial,Helvetica,sans-serif;"></span><br /><span style="font-family: Arial,Helvetica,sans-serif;"></span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span>
