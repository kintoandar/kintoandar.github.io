---
layout: post
title: ModSecurity Nagios NRPE Check
date: '2013-01-13T12:24:00.000Z'
author: Joel Bastos
tags: 
modified_time: '2013-01-17T16:25:35.720Z'
thumbnail: http://3.bp.blogspot.com/-SAaOJQBRvSU/UPKkHeWsXBI/AAAAAAAAAnE/yRIwWVpqKH0/s72-c/Mod-Security.png
blogger_id: tag:blogger.com,1999:blog-1780138848439428569.post-326176259240043207
blogger_orig_url: http://blog.kintoandar.com/2013/01/modsecurity-nagios-nrpe-check.html
comments: true
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://www.modsecurity.org/" imageanchor="1" style="margin-left: 1em; margin-right: 1em;" target="_blank"><img border="0" src="http://3.bp.blogspot.com/-SAaOJQBRvSU/UPKkHeWsXBI/AAAAAAAAAnE/yRIwWVpqKH0/s1600/Mod-Security.png" /></a></div><span style="font-family: Arial,Helvetica,sans-serif;">Even with our best efforts web servers/applications security are always vulnerable to 0 day exploits, poorly written code or even a bad configuration. Introducing <a href="http://www.modsecurity.org/projects/modsecurity/" target="_blank">ModSecurity</a>, a web application firewall or layer 7 firewall (but I truly despise this denomination), it works inspecting web traffic looking for suspicions patterns and, for example, stopping a malicious attempt with a http 403 forbidden.</span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">But even with a very impressive success rate on preventing exploits, there's still the need to audit its logs and get notifications of the evil attempts. <a href="http://www.jwall.org/web/audit/console/index.jsp" target="_blank">AuditConsole</a> has the best auditing capabilities I've tested so far and for the notification component there's nothing like cooking a quick and dirty NRPE script:</span><br /><blockquote class="tr_bq"><span style="font-family: Arial,Helvetica,sans-serif;">&nbsp;#!/bin/bash<br /><br />######################<br /># blog.kintoandar.com<br />######################<br /><br /># vhost(s) logs<br />LOGS="/vhost/logs/*log"<br /><br /># 24h notification<br />DATE=`date |awk {'print $1" "$2" "$3'}`<br /><br /># count number of criticals<br />COUNT=`grep CRITICAL $LOGS | grep -c "$DATE"`<br /><br /># OK<br />if [ $COUNT -eq 0 ] ; then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "0 hits found"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit 0 <br />fi<br /><br /># CRITICAL<br />echo "$COUNT hits found"<br />exit 2</span></blockquote><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><span style="font-family: Arial,Helvetica,sans-serif;"><a href="https://github.com/kintoandar/shell_scripts/blob/master/nrpe/check_modsec.sh" target="_blank">github link</a></span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span>
